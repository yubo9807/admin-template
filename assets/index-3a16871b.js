var z=Object.defineProperty;var G=(e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>(G(e,typeof t!="symbol"?t+"":t,n),n),F=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var I=(e,t,n)=>(F(e,t,"read from private field"),n?n.call(e):t.get(e)),L=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},T=(e,t,n,f)=>(F(e,t,"write to private field"),f?f.call(e,n):t.set(e,n),n);import P from"./index-66aa64a0.js";import Q from"./index-45c8e1c6.js";import H from"./index-26838c1c.js";import{d as J}from"./date-36c22e1f.js";import{G as K,d as M,M as W,N as B,O as S,g as U,q as X,P as N,Q as Y,n as Z,E as x,S as ee,T as V,U as te,V as ne,_ as oe,r as p,o as R,e as E,w as r,b as i,I as le,B as g,t as ie,a as $,j as A}from"./index-f0fda0f1.js";import{I as ae}from"./init-table-55f0cb87.js";import"./index-fedbfd27.js";import"./index-b016161c.js";import"./index-e472fd01.js";import"./index-5b112b07.js";const se={name:"",title:""};var k;class re extends ae{constructor(){super(se,S);L(this,k,null);b(this,"nowRole",K({role:"",id:""}));b(this,"roleList",M([]));b(this,"getRoleList",async()=>{const[n,f]=await W({});if(n)return!1;const d=B(f.data);return d.length===0?!1:(this.roleList.value=d,d.length>0&&(this.nowRole.role=d[0].role,this.nowRole.id=d[0].id),!0)});b(this,"treeNodeClick",n=>{this.nowRole.id=n.id});b(this,"flatData",M([]));b(this,"initData",async()=>{if(this.roleList.value.length===0&&!await this.getRoleList())return;const n=Y({roleId:this.nowRole.id,...this.form}),[f,d]=await S(n);if(f)return;const h=d.data,w=B(h);this.flatData.value=h,this.tableData.value=w,Z(()=>{const y=I(this,k).refs.tableEl;O(this.tableData.value,y)})});T(this,k,U()),this.getRoleList(),X(()=>this.nowRole.id,n=>{this.initData()}),N("getRoleList",()=>this.roleList.value),N("getMenuList",()=>this.tableData.value)}}k=new WeakMap;function O(e,t){e.forEach(n=>{t.toggleRowSelection(n,n.selected),n.children&&n.children.length>0&&n.children.map(f=>{O(n.children,t)})})}const ue=()=>{const e=U(),t=e.proxy,n=K({name:"",id:""});function f(l={}){n.name=l.name,n.id=l.id,e.refs.drawerConfig.visible=!0}const d=M(0),h=M({});function w(){d.value=0,h.value={},e.refs.dialogMenu.visible=!0}function y(l){const{id:s,name:a,title:u,parent:o}=l;d.value=1,h.value={id:s,name:a,title:u,parent:o},e.refs.dialogMenu.visible=!0}function v(l){x.confirm("确认删除该用户？删除后配置中的接口/元素会归类到公共配置中！","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const[s,a]=await ee({id:l.id});s||(V.success("删除成功"),t.initData())}).catch(()=>{})}async function _(l){const s=l.map(c=>c.id),a=t.flatData.filter(c=>!s.includes(c.id)).map(c=>c.id),u={tableType:"menu",roleId:t.nowRole.id,contactIdList:s,deleteIdList:a},[o]=await te(u);o||t.initData()}function m(l,s){const a=D(l,t.tableData);if(!a)return!1;const u=a.findIndex(o=>o.id===l.id);return s==="up"?u!==0:u!==a.length-1}async function C(l,s){if(!m(l,s))return;const a=D(l,t.tableData),u=a.findIndex(q=>q.id===l.id),c=a[u+(s==="down"?1:-1)].id,[j]=await ne({id1:l.id,id2:c});j||(V.success("移动成功"),t.initData())}function D(l,s){for(const a of s){if(a.children&&a.children.length>0){const u=D(l,a.children);if(u)return u}if(a.id!==l.id&&a.parent===l.parent)return s}return null}return{selectMenu:n,showConfig:f,dialogMenuType:d,dialogMenuNeed:h,addMenu:w,modifyMenu:y,deleteMenu:v,select:_,moveRow:C,canMove:m}},de={name:"SystemMenu",components:{DrawerConfig:P,TableAddBtn:Q,DialogMenu:H},setup(){return{dateFormater:J,...new re,...ue()}}};const ce={class:"sort-box"},fe={class:"sort-box"};function pe(e,t,n,f,d,h){const w=p("el-tree-select"),y=p("el-input"),v=p("el-button"),_=p("LayoutSearch"),m=p("el-table-column"),C=p("el-link"),D=p("el-table"),l=p("TableAddBtn"),s=p("DrawerConfig"),a=p("DialogMenu"),u=p("LayoutContainer");return R(),E(u,null,{default:r(()=>[i(_,{"right-width":"320px"},{left:r(()=>[i(w,{modelValue:e.nowRole.id,"onUpdate:modelValue":t[0]||(t[0]=o=>e.nowRole.id=o),data:e.roleList,clearable:"",props:{children:"children",label:"role",value:"id"},"render-after-expand":!1,onNodeClick:e.treeNodeClick},null,8,["modelValue","data","onNodeClick"]),i(y,{modelValue:e.form.title,"onUpdate:modelValue":t[1]||(t[1]=o=>e.form.title=o),class:"input",placeholder:"请输入菜单名称",onKeyup:le(e.search,["enter"]),onClear:e.search},null,8,["modelValue","onKeyup","onClear"])]),right:r(()=>[i(v,{type:"primary",onClick:e.search},{default:r(()=>t[3]||(t[3]=[g("查询")])),_:1},8,["onClick"]),i(v,{onClick:e.reset},{default:r(()=>t[4]||(t[4]=[g("重置")])),_:1},8,["onClick"]),i(v,{type:"primary",onClick:t[2]||(t[2]=o=>e.showConfig())},{default:r(()=>t[5]||(t[5]=[g("公共配置")])),_:1})]),_:1}),i(D,{ref:"tableEl",data:e.tableData,"row-key":"id","tree-props":{children:"children"},onSelect:e.select,onSelectAll:e.select},{default:r(()=>[i(m,{type:"selection",width:"40",label:""}),i(m,{type:"index",label:"序号",width:"60"}),i(m,{label:"菜单名称",prop:"title"}),i(m,{label:"Name",prop:"name"}),i(m,{label:"更新时间"},{default:r(o=>[g(ie(f.dateFormater((o.row.updateTime||o.row.createTime)*1e3)),1)]),_:1}),i(m,{label:"排序",fixed:"right",width:"80"},{default:r(({row:o})=>[$("span",ce,[e.canMove(o,"up")?(R(),E(C,{key:0,onClick:c=>e.moveRow(o,"up"),style:{color:"var(--main-color-font-success)"}},{default:r(()=>t[6]||(t[6]=[g("⬆︎")])),_:2},1032,["onClick"])):A("",!0)]),$("span",fe,[e.canMove(o,"down")?(R(),E(C,{key:0,onClick:c=>e.moveRow(o,"down"),style:{color:"var(--main-color-font-error)"}},{default:r(()=>t[7]||(t[7]=[g("⬇︎")])),_:2},1032,["onClick"])):A("",!0)])]),_:1}),i(m,{label:"操作",fixed:"right",width:"140"},{default:r(({row:o})=>[i(C,{onClick:c=>e.showConfig(o)},{default:r(()=>t[8]||(t[8]=[g("配置")])),_:2},1032,["onClick"]),i(C,{onClick:c=>e.modifyMenu(o)},{default:r(()=>t[9]||(t[9]=[g("修改")])),_:2},1032,["onClick"]),i(C,{type:"danger",onClick:c=>e.deleteMenu(o)},{default:r(()=>t[10]||(t[10]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelect","onSelectAll"]),i(l,{onClick:e.addMenu},null,8,["onClick"]),i(s,{ref:"drawerConfig",roleId:e.nowRole.id,menuId:e.selectMenu.id},null,8,["roleId","menuId"]),i(a,{ref:"dialogMenu",type:e.dialogMenuType,need:e.dialogMenuNeed,onSuccess:e.initData},null,8,["type","need","onSuccess"])]),_:1})}const _e=oe(de,[["render",pe],["__scopeId","data-v-f8ecd3eb"]]);export{_e as default};
