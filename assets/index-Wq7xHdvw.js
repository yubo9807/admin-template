var J=Object.defineProperty;var L=e=>{throw TypeError(e)};var P=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>P(e,typeof t!="symbol"?t+"":t,n),I=(e,t,n)=>t.has(e)||L("Cannot "+n);var _=(e,t,n)=>(I(e,t,"read from private field"),n?n.call(e):t.get(e)),S=(e,t,n)=>t.has(e)?L("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),T=(e,t,n,f)=>(I(e,t,"write to private field"),f?f.call(e,n):t.set(e,n),n);import Q from"./index-C-PSV7dU.js";import q from"./index-DIfgfXqq.js";import G from"./index-CJ6nuy01.js";import{d as W}from"./date-CMk_DNDl.js";import{D as O,d as M,J as X,K as B,L as N,g as U,p as Y,M as V,N as Z,n as x,E as ee,O as te,P as $,Q as ne,S as oe,_ as le,r as p,o as E,e as F,w as s,b as i,H as ie,A as g,t as ae,a as A,j as K}from"./index-CUJUVGxI.js";import{I as re}from"./init-table-DeU0H5lE.js";import"./index-CbLjePSf.js";import"./index-DZG7OKB_.js";import"./index-CZ2x3cBJ.js";import"./index-LabX5NDG.js";const se={name:"",title:""};var v;class ue extends re{constructor(){super(se,N);S(this,v,null);b(this,"nowRole",O({role:"",id:""}));b(this,"roleList",M([]));b(this,"getRoleList",async()=>{const[n,f]=await X({});if(n)return!1;const d=B(f.data);return d.length===0?!1:(this.roleList.value=d,d.length>0&&(this.nowRole.role=d[0].role,this.nowRole.id=d[0].id),!0)});b(this,"treeNodeClick",n=>{this.nowRole.id=n.id});b(this,"flatData",M([]));b(this,"initData",async()=>{if(this.roleList.value.length===0&&!await this.getRoleList())return;const n=Z({roleId:this.nowRole.id,...this.form}),[f,d]=await N(n);if(f)return;const h=d.data,w=B(h);this.flatData.value=h,this.tableData.value=w,x(()=>{const y=_(this,v).refs.tableEl;j(this.tableData.value,y)})});T(this,v,U()),this.getRoleList(),Y(()=>this.nowRole.id,n=>{this.initData()}),V("getRoleList",()=>this.roleList.value),V("getMenuList",()=>this.tableData.value)}}v=new WeakMap;function j(e,t){e.forEach(n=>{t.toggleRowSelection(n,n.selected),n.children&&n.children.length>0&&n.children.map(f=>{j(n.children,t)})})}const de=()=>{const e=U(),t=e.proxy,n=O({name:"",id:""});function f(l={}){n.name=l.name,n.id=l.id,e.refs.drawerConfig.visible=!0}const d=M(0),h=M({});function w(){d.value=0,h.value={},e.refs.dialogMenu.visible=!0}function y(l){const{id:r,name:a,title:u,parent:o}=l;d.value=1,h.value={id:r,name:a,title:u,parent:o},e.refs.dialogMenu.visible=!0}function D(l){ee.confirm("确认删除该用户？删除后配置中的接口/元素会归类到公共配置中！","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{const[r,a]=await te({id:l.id});r||($.success("删除成功"),t.initData())}).catch(()=>{})}async function R(l){const r=l.map(c=>c.id),a=t.flatData.filter(c=>!r.includes(c.id)).map(c=>c.id),u={tableType:"menu",roleId:t.nowRole.id,contactIdList:r,deleteIdList:a},[o]=await ne(u);o||t.initData()}function m(l,r){const a=k(l,t.tableData);if(!a)return!1;const u=a.findIndex(o=>o.id===l.id);return r==="up"?u!==0:u!==a.length-1}async function C(l,r){if(!m(l,r))return;const a=k(l,t.tableData),u=a.findIndex(H=>H.id===l.id),c=a[u+(r==="down"?1:-1)].id,[z]=await oe({id1:l.id,id2:c});z||($.success("移动成功"),t.initData())}function k(l,r){for(const a of r){if(a.children&&a.children.length>0){const u=k(l,a.children);if(u)return u}if(a.id!==l.id&&a.parent===l.parent)return r}return null}return{selectMenu:n,showConfig:f,dialogMenuType:d,dialogMenuNeed:h,addMenu:w,modifyMenu:y,deleteMenu:D,select:R,moveRow:C,canMove:m}},ce={name:"SystemMenu",components:{DrawerConfig:Q,TableAddBtn:q,DialogMenu:G},setup(){return{dateFormater:W,...new ue,...de()}}},fe={class:"sort-box"},pe={class:"sort-box"};function me(e,t,n,f,d,h){const w=p("el-tree-select"),y=p("el-input"),D=p("el-button"),R=p("LayoutSearch"),m=p("el-table-column"),C=p("el-link"),k=p("el-table"),l=p("TableAddBtn"),r=p("DrawerConfig"),a=p("DialogMenu"),u=p("LayoutContainer");return E(),F(u,null,{default:s(()=>[i(R,{"right-width":"320px"},{left:s(()=>[i(w,{modelValue:e.nowRole.id,"onUpdate:modelValue":t[0]||(t[0]=o=>e.nowRole.id=o),data:e.roleList,clearable:"",props:{children:"children",label:"role",value:"id"},"render-after-expand":!1,onNodeClick:e.treeNodeClick},null,8,["modelValue","data","onNodeClick"]),i(y,{modelValue:e.form.title,"onUpdate:modelValue":t[1]||(t[1]=o=>e.form.title=o),class:"input",placeholder:"请输入菜单名称",onKeyup:ie(e.search,["enter"]),onClear:e.search},null,8,["modelValue","onKeyup","onClear"])]),right:s(()=>[i(D,{type:"primary",onClick:e.search},{default:s(()=>t[3]||(t[3]=[g("查询")])),_:1},8,["onClick"]),i(D,{onClick:e.reset},{default:s(()=>t[4]||(t[4]=[g("重置")])),_:1},8,["onClick"]),i(D,{type:"primary",onClick:t[2]||(t[2]=o=>e.showConfig())},{default:s(()=>t[5]||(t[5]=[g("公共配置")])),_:1})]),_:1}),i(k,{ref:"tableEl",data:e.tableData,"row-key":"id","tree-props":{children:"children"},onSelect:e.select,onSelectAll:e.select},{default:s(()=>[i(m,{type:"selection",width:"40",label:""}),i(m,{type:"index",label:"序号",width:"60"}),i(m,{label:"菜单名称",prop:"title"}),i(m,{label:"Name",prop:"name"}),i(m,{label:"更新时间"},{default:s(o=>[g(ae(f.dateFormater((o.row.updateTime||o.row.createTime)*1e3)),1)]),_:1}),i(m,{label:"排序",fixed:"right",width:"80"},{default:s(({row:o})=>[A("span",fe,[e.canMove(o,"up")?(E(),F(C,{key:0,onClick:c=>e.moveRow(o,"up"),style:{color:"var(--main-color-font-success)"}},{default:s(()=>t[6]||(t[6]=[g("⬆︎")])),_:2},1032,["onClick"])):K("",!0)]),A("span",pe,[e.canMove(o,"down")?(E(),F(C,{key:0,onClick:c=>e.moveRow(o,"down"),style:{color:"var(--main-color-font-error)"}},{default:s(()=>t[7]||(t[7]=[g("⬇︎")])),_:2},1032,["onClick"])):K("",!0)])]),_:1}),i(m,{label:"操作",fixed:"right",width:"140"},{default:s(({row:o})=>[i(C,{onClick:c=>e.showConfig(o)},{default:s(()=>t[8]||(t[8]=[g("配置")])),_:2},1032,["onClick"]),i(C,{onClick:c=>e.modifyMenu(o)},{default:s(()=>t[9]||(t[9]=[g("修改")])),_:2},1032,["onClick"]),i(C,{type:"danger",onClick:c=>e.deleteMenu(o)},{default:s(()=>t[10]||(t[10]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelect","onSelectAll"]),i(l,{onClick:e.addMenu},null,8,["onClick"]),i(r,{ref:"drawerConfig",roleId:e.nowRole.id,menuId:e.selectMenu.id},null,8,["roleId","menuId"]),i(a,{ref:"dialogMenu",type:e.dialogMenuType,need:e.dialogMenuNeed,onSuccess:e.initData},null,8,["type","need","onSuccess"])]),_:1})}const Ee=le(ce,[["render",me],["__scopeId","data-v-f8ecd3eb"]]);export{Ee as default};
